<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Latin Declension Trainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .game {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      width: 100%;
      height: 100%;
      text-align: center;
    }
    .choices {
      margin-bottom: 1rem;
    }
    .choices button {
      margin: 5px;
      padding: 6px 12px;
      border: 1px solid #aaa;
      border-radius: 8px;
      background: #eee;
      cursor: pointer;
    }
    .choices button.active {
      background: #4caf50;
      color: white;
    }
    input {
      padding: 8px;
      width: 80%;
      margin: 10px 0;
    }
    button.submit {
      padding: 10px 15px;
      margin-top: 10px;
      border: none;
      background: #4caf50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button.submit:hover {
      background: #45a049;
    }
    .feedback {
      margin-top: 15px;
      font-weight: bold;
    }
    #tables-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 0 auto;
    }
    #tables-container table {
      flex: 0 0 auto;
      border-collapse: collapse;
      min-width: 200px;
      margin: 0 auto;
      display: none; /* hidden by default, shown if enabled */
    }
    #tables-container caption {
      font-weight: bold;
      margin-bottom: 5px;
    }
    #tables-container th,
    #tables-container td {
      border: 1px solid #444;
      padding: 6px 10px;
      margin: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="game">
    <h2>Latin Declension Trainer</h2>

    <div class="choices" id="choices"></div>

    <p id="question"></p>
    <input type="text" id="answer" placeholder="Type your answer..." />
    <button class="submit" onclick="submitAnswer()">Submit</button>
    <p class="feedback" id="feedback"></p>
    <p id="stats"></p>
    <button id="toggle" class="choices">Table</button>
    <div id="tables-container"></div>
  </div>
  <script>
    const tables = {
      "1st declension": {
        gender: "feminine",
        cases: {
          nominative: {singular: "a", plural: "ae"},
          genitive:   {singular: "ae", plural: "arum"},
          dative:     {singular: "ae", plural: "is"},
          accusative: {singular: "am", plural: "as"},
          ablative:   {singular: "a", plural: "is"},
          vocative:   {singular: "a", plural: "ae"},
        }
      },
      "2nd declension (m)": {
        gender: "masculine",
        cases: {
          nominative: {singular: "us", plural: "i"},
          genitive:   {singular: "i", plural: "orum"},
          dative:     {singular: "o", plural: "is"},
          accusative: {singular: "um", plural: "os"},
          ablative:   {singular: "o", plural: "is"},
          vocative:   {singular: "e", plural: "i"},
        }
      },
      "2nd declension (n)": {
        gender: "neuter",
        cases: {
          nominative: {singular: "um", plural: "a"},
          genitive:   {singular: "i", plural: "orum"},
          dative:     {singular: "o", plural: "is"},
          accusative: {singular: "um", plural: "a"},
          ablative:   {singular: "o", plural: "is"},
          vocative:   {singular: "um", plural: "a"},
        }
      },
      "3rd declension": {
        gender: "neuter",
        cases: {
          nominative: {singular: "", plural: ["a", "ia"]},
          genitive:   {singular: "is", plural: ["um", "ium"]},
          dative:     {singular: "i", plural: "ibus"},
          accusative: {singular: "", plural: ["a", "ia"]},
          ablative:   {singular: ["e", "i"], plural: "ibus"},
          vocative:   {singular:"", plural: ["a", "ia"]}
        }
      }
    };

    let enabled = {};
    Object.keys(tables).forEach(key => enabled[key] = true);

    let questions = [];
    let currentQuestion = null;
    let reactionTimes = [];
    let questionStartTime = null;

    function generateQuestions() {
      let qs = [];
      for (let paradigm in tables) {
        if (!enabled[paradigm]) continue;
        let data = tables[paradigm];
        for (let c in data.cases) {
          for (let num in data.cases[c]) {
            qs.push({
              q: `${paradigm} (${data.gender}): What is the ${c.toUpperCase()} ${num.toUpperCase()} ending?`,
              a: data.cases[c][num],
              paradigm
            });
          }
        }
      }
      return qs;
    }

    function buildChoices() {
      const container = document.getElementById("choices");
      container.innerHTML = "";
      for (let paradigm in tables) {
        const btn = document.createElement("button");
        btn.textContent = paradigm;
        btn.classList.toggle("active", enabled[paradigm]);
        btn.onclick = () => {
          enabled[paradigm] = !enabled[paradigm];
          btn.classList.toggle("active", enabled[paradigm]);
          questions = generateQuestions();
          updateTableVisibility();
          loadQuestion();
        };
        container.appendChild(btn);
      }
    }

    function updateTableVisibility() {
      for (let paradigm in tables) {
        const table = document.getElementById(`table-${paradigm}`);
        if (!table) continue;
        table.style.display = enabled[paradigm] && tableToggled ? "table" : "none";
      }
    }

    function loadQuestion() {
      questions = generateQuestions();
      if (questions.length === 0) {
        document.getElementById("question").textContent = "❗ Enable at least one table above.";
        return;
      }
      currentQuestion = questions[Math.floor(Math.random() * questions.length)];
      document.getElementById("question").textContent = currentQuestion.q;
      document.getElementById("answer").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer").style.display = "inline";
      document.getElementById("answer").focus();
      questionStartTime = performance.now();
    }

    function submitAnswer() {
      let userAnswer = document.getElementById("answer").value.trim().toLowerCase();
      let correctAnswer = currentQuestion.a;

      function isCorrect(userAnswer, correctAnswer) {
        if (typeof correctAnswer === "string") return userAnswer === correctAnswer;
        if (Array.isArray(correctAnswer)) return correctAnswer.includes(userAnswer);
        return false;
      }

      if (isCorrect(userAnswer, correctAnswer)) {
        let reactionTime = performance.now() - questionStartTime;
        reactionTimes.push(reactionTime);
        let avg = reactionTimes.reduce((a,b)=>a+b,0) / reactionTimes.length;

        document.getElementById("feedback").textContent = `✅ Correct! (${(reactionTime/1000).toFixed(2)}s)`;
        document.getElementById("stats").textContent = `Average reaction time: ${(avg/1000).toFixed(2)}s`;

        setTimeout(loadQuestion, 1000);
      } else {
        document.getElementById("feedback").textContent = `❌ Incorrect, try again.`;
        document.getElementById("answer").value = "";
      }
    }

    document.getElementById("answer").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        submitAnswer();
      }
    });

    buildChoices();
    loadQuestion();

    const container = document.getElementById("tables-container");
    container.style.display = "none";

    function formatValue(value) {
      if (Array.isArray(value)) {
        return value.join(" / ");
      }
      return value || "—";
    }

    for (const [declension, data] of Object.entries(tables)) {
      const table = document.createElement("table");
      table.id = `table-${declension}`;

      const caption = document.createElement("caption");
      caption.textContent = `${declension} (${data.gender})`;
      table.appendChild(caption);

      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Case</th>
          <th>Singular</th>
          <th>Plural</th>
        </tr>
      `;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      for (const [caseName, forms] of Object.entries(data.cases)) {
        const row = document.createElement("tr");

        const caseCell = document.createElement("td");
        caseCell.textContent = caseName.charAt(0).toUpperCase() + caseName.slice(1);
        row.appendChild(caseCell);

        const singularCell = document.createElement("td");
        singularCell.textContent = formatValue(forms.singular);
        row.appendChild(singularCell);

        const pluralCell = document.createElement("td");
        pluralCell.textContent = formatValue(forms.plural);
        row.appendChild(pluralCell);

        tbody.appendChild(row);
      }
      table.appendChild(tbody);

      container.appendChild(table);
    }

    const toggleBtn = document.getElementById("toggle")
    let tableToggled = false
    toggleBtn.addEventListener("click", () => {
        tableToggled = !tableToggled;
        container.style.display = tableToggled ? "flex" : "none";
        updateTableVisibility();
    })

    updateTableVisibility();
  </script>
</body>
</html>

