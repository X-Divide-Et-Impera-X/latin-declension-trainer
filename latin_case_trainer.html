<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Latin Declension Trainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
    }
    .game {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      width: 100%;
      height: 100%;
      text-align: center;
      overflow-y: auto;
    }
    .choices {
      margin-bottom: 1rem;
    }
    .choices button {
      margin: 5px;
      padding: 6px 12px;
      border: 1px solid #aaa;
      border-radius: 8px;
      background: #eee;
      cursor: pointer;
    }
    .choices button.active {
      background: #4caf50;
      color: white;
    }
    input {
      padding: 8px;
      width: 80%;
      margin: 10px 0;
    }
    button.submit {
      padding: 10px 15px;
      margin-top: 10px;
      border: none;
      background: #4caf50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button.submit:hover {
      background: #45a049;
    }
    .feedback {
      margin-top: 15px;
      font-weight: bold;
    }
    #tables-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 0 auto;
    }
    #tables-container table {
      border-collapse: collapse;
      min-width: 200px;
      margin: 0 auto;
      flex: 1 1 calc(33.333% - 40px);
    }
    #tables-container caption {
      font-weight: bold;
      margin-bottom: 5px;
    }
    #tables-container th,
    #tables-container td {
      border: 1px solid #444;
      padding: 6px 10px;
      text-align: center;
    }
    #performance-msg {
      margin-top: 20px;
      font-size: 1.2em;
      font-weight: bold;
      color: #ff9800;
    }
    #stats {
      margin-top: 10px;
      font-size: 1em;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="game">
    <h2>Latin Declension Trainer</h2>

    <div class="choices" id="choices"></div>

    <p id="performance-msg"></p>
    <p id="stats"></p>

    <p id="question"></p>
    <input type="text" id="answer" placeholder="Type your answer..." />
    <button class="submit" onclick="submitAnswer()">Submit</button>
    <p class="feedback" id="feedback"></p>

    <button id="toggle" class="choices">Table</button>
    <div id="tables-container"></div>


  </div>

  <script>
    // Declension tables
    const tables = {
      "1st declension": {
        gender: "feminine",
        cases: {
          nominative: {singular: "a", plural: "ae"},
          genitive:   {singular: "ae", plural: "arum"},
          dative:     {singular: "ae", plural: "is"},
          accusative: {singular: "am", plural: "as"},
          ablative:   {singular: "a", plural: "is"},
          vocative:   {singular: "a", plural: "ae"},
        }
      },
      "2nd declension (m)": {
        gender: "masculine",
        cases: {
          nominative: {singular: "us", plural: "i"},
          genitive:   {singular: "i", plural: "orum"},
          dative:     {singular: "o", plural: "is"},
          accusative: {singular: "um", plural: "os"},
          ablative:   {singular: "o", plural: "is"},
          vocative:   {singular: "e", plural: "i"},
        }
      },
      "2nd declension (n)": {
        gender: "neuter",
        cases: {
          nominative: {singular: "um", plural: "a"},
          genitive:   {singular: "i", plural: "orum"},
          dative:     {singular: "o", plural: "is"},
          accusative: {singular: "um", plural: "a"},
          ablative:   {singular: "o", plural: "is"},
          vocative:   {singular: "um", plural: "a"},
        }
      },
      "3rd declension": {
        gender: "neuter",
        cases: {
          nominative: {singular: "", plural: ["a", "ia"]},
          genitive:   {singular: "is", plural: ["um", "ium"]},
          dative:     {singular: "i", plural: "ibus"},
          accusative: {singular: "", plural: ["a", "ia"]},
          ablative:   {singular: ["e", "i"], plural: "ibus"},
          vocative:   {singular:"", plural: ["a", "ia"]}
        }
      },
      "4th declension (n)": {
        gender: "neuter",
        cases: {
          nominative: {singular: "u", plural: "ua"},
          genitive:   {singular: "us", plural: "uum"},
          dative:     {singular: "u", plural: ["ibus","ubus"]},
          accusative: {singular: "u", plural: "ua"},
          ablative:   {singular: "u", plural: ["ibus","ubus"]},
          vocative:   {singular:"u", plural: "ua"}
        }
      },
      "4th declension (m)": {
        gender: "masculine",
        cases: {
          nominative: {singular: "us", plural: "us"},
          genitive:   {singular: "us", plural: "uum"},
          dative:     {singular: ["ui", "u"], plural: ["ibus","ubus"]},
          accusative: {singular: "um", plural: "us"},
          ablative:   {singular: "u", plural: ["ibus","ubus"]},
          vocative:   {singular:"us", plural: "ua"}
        }
      },
      "5th declension (f)": {
        gender: "feminine",
        cases: {
          nominative: {singular: "es", plural: "es"},
          genitive:   {singular: ["ei", "e"], plural: "erum"},
          dative:     {singular: ["ei", "e"], plural: "ebus"},
          accusative: {singular: "em", plural: "es"},
          ablative:   {singular: "e", plural: "ebus"},
          vocative:   {singular:"es", plural: "es"}
        }
      },
    };

    let enabled = {};
    Object.keys(tables).forEach(key => enabled[key] = true);

    let currentQuestion = null;
    let questionsAnswered = 0;
    let correctAnswers = 0;
    let reactionTimes = [];
    let startTime = Date.now();



    // Emoji for each case
    function caseEmoji(caseName) {
      switch (caseName.toLowerCase()) {
        case "nominative": return "üë§";   // subject
        case "genitive":   return "üîë";   // possession
        case "dative":     return "üéÅ";   // to/for
        case "accusative": return "üéØ";   // object/goal
        case "ablative":   return "üõ†Ô∏èüö™";   // by/with/from
        case "vocative":   return "üó£Ô∏è";   // calling
        default: return "‚ùì";
      }
    }
    // Emoji for singular vs plural
    function singularPluralEmoji(num) {
      switch (num.toLowerCase()) {
        case "singular": return "1Ô∏è‚É£";
        case "plural":   return "üë•";
        default: return "‚ùì";
      }
    }



    function getRandomQuestion() {
      const paradigms = Object.keys(tables).filter(p => enabled[p]);
      if (paradigms.length === 0) return null;

      const paradigm = paradigms[Math.floor(Math.random() * paradigms.length)];
      const data = tables[paradigm];

      const caseNames = Object.keys(data.cases);
      const c = caseNames[Math.floor(Math.random() * caseNames.length)];
      const num = Math.random() < 0.5 ? "singular" : "plural";

      return {
        q: `${paradigm} (${data.gender}): What is the ${caseEmoji(c)} ${singularPluralEmoji(num)} ${c.toUpperCase()} ${num.toUpperCase()} ending?`,
        a: data.cases[c][num]
      };
    }

    function loadQuestion() {
      currentQuestion = getRandomQuestion();
      if (!currentQuestion) {
        document.getElementById("question").textContent = "‚ùó Enable at least one table above.";
        return;
      }
      document.getElementById("question").textContent = currentQuestion.q;
      document.getElementById("answer").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer").focus();
      startTime = Date.now();
    }

    function isCorrect(userAnswer, correctAnswer) {
      if (typeof correctAnswer === "string") return userAnswer === correctAnswer;
      if (Array.isArray(correctAnswer)) return correctAnswer.includes(userAnswer);
      return false;
    }

    function submitAnswer() {
      if (!currentQuestion) return;

      let userAnswer = document.getElementById("answer").value.trim().toLowerCase();
      let correctAnswer = currentQuestion.a;
      if (typeof correctAnswer === "string") correctAnswer = correctAnswer.toLowerCase();
      else correctAnswer = correctAnswer.map(c => c.toLowerCase());

      const timeTaken = (Date.now() - startTime) / 1000;
      questionsAnswered++;

      if (isCorrect(userAnswer, correctAnswer)) {
        document.getElementById("feedback").textContent = `‚úÖ Correct!`;
        correctAnswers++;
        reactionTimes.push(timeTaken);
        setTimeout(loadQuestion, 800);
      } else {
        document.getElementById("feedback").textContent = `‚ùå Incorrect, try again.`;
        document.getElementById("answer").value = "";
        return;
      }

      updatePerformanceMsg();
    }

    document.getElementById("answer").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        submitAnswer();
      }
    });

    function buildChoices() {
      const container = document.getElementById("choices");
      container.innerHTML = "";
      for (let paradigm in tables) {
        const btn = document.createElement("button");
        btn.textContent = paradigm;
        btn.classList.toggle("active", enabled[paradigm]);
        btn.onclick = () => {
          enabled[paradigm] = !enabled[paradigm];
          btn.classList.toggle("active", enabled[paradigm]);
          loadQuestion();
        };
        container.appendChild(btn);
      }
    }

    function updatePerformanceMsg() {
      let msg = "";
      let statsMsg = "";
      if (questionsAnswered > 0) {
        const correctRate = (correctAnswers / questionsAnswered) * 100;
        const avgTime = reactionTimes.reduce((a,b)=>a+b,0) / reactionTimes.length;

        statsMsg = `Correct rate: ${correctRate.toFixed(1)}% | Avg. reaction time: ${avgTime.toFixed(2)}s`;

        if (correctRate >= 100 && avgTime < 2) {
          msg = "üíØ Accuracy Master! Perfect score!";
        } 
        else if (correctRate >= 95) {
          msg = "üåü You're doing great!";
        } 
        else if (correctRate >= 90) {
          msg = "‚úÖ Excellent accuracy!";
        } 
        else if (correctRate >= 80) {
          msg = "üëç Solid work, keep pushing!";
        } 
        else if (correctRate < 50) {
          msg = "üìò Don‚Äôt worry, keep practicing!";
        }

        if (avgTime < 1.5) {
          msg += " ‚ö° Lightning fast!";
        } 
        else if (avgTime < 3) {
          msg += " ‚è±Ô∏è Good pace!";
        } 
        else if (avgTime > 5) {
          msg += " üå± Steady progress, keep focusing!";
        }
      }
      document.getElementById("performance-msg").textContent = msg;
      document.getElementById("stats").textContent = statsMsg;
    }

    // build declension tables
    const container = document.getElementById("tables-container");
    container.style.display = "none";

    function formatValue(value) {
      if (Array.isArray(value)) {
        return value.join(" / ");
      }
      return value || "‚Äî";
    }

    for (const [declension, data] of Object.entries(tables)) {
      const table = document.createElement("table");

      const caption = document.createElement("caption");
      caption.textContent = `${declension} (${data.gender})`;
      table.appendChild(caption);

      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Case</th>
          <th>Singular</th>
          <th>Plural</th>
        </tr>
      `;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      for (const [caseName, forms] of Object.entries(data.cases)) {
        const row = document.createElement("tr");

        const caseCell = document.createElement("td");
        caseCell.textContent = caseName.charAt(0).toUpperCase() + caseName.slice(1);
        row.appendChild(caseCell);

        const singularCell = document.createElement("td");
        singularCell.textContent = formatValue(forms.singular);
        row.appendChild(singularCell);

        const pluralCell = document.createElement("td");
        pluralCell.textContent = formatValue(forms.plural);
        row.appendChild(pluralCell);

        tbody.appendChild(row);
      }
      table.appendChild(tbody);

      container.appendChild(table);
    }

    const toggleBtn = document.getElementById("toggle")
    let tableToggled = false
    toggleBtn.addEventListener("click", () => {
        tableToggled = !tableToggled;
        container.style.display = tableToggled ? "flex" : "none";
    });

    buildChoices();
    loadQuestion();
  </script>
</body>
</html>

